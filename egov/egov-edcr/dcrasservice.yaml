openapi: "3.0.0"
info:
  version: 1.0.0
  title: eDCR as service
  description: Service to scrutinize the plan in dxf file format, validate  with dcr rules and generate report. The rules are configured to a state/city level. Using dxf file, generate the pdf's like section plan, elevation plan, floor plan and parking plan. The content of plans are return in json form data. Use the transaction number or dcr number to track the status/retrieve the saved dcr information.
  contact:
    name: Egovernments Foundation
    email: contact@egovernments.org
servers:
- url: https://egov-dcr-galaxy.egovernments.org/edcr
  description: Development server
paths:
  /rest/dcr/scrutinizeplan:
    post:
      summary: Scrutinize dxf file scrutiny.
      requestBody:
        content:
          multipart/mixed:
            schema:
              $ref: '#/components/schemas/ScrutinizePlanReq'
            encoding:
              dxfFile:
              # only accept dxf file.
                contentType: application/dxf
      responses:
        '200':
          description: scrutinize plan successful.
          content:
            application/json:
              schema:
                 $ref: '#/components/schemas/ScrutinizePlanResponse'
              encoding:
                dxfFile:
                # only accept dxf file.
                  contentType: application/dxf
                planPdfs:
                  contentType: application/pdf
                planReport:
                  contentType: application/pdf   
        '400':
          description: Invalid Input
          content:
            application/json:
              schema:
                 $ref: 'https://raw.githubusercontent.com/egovernments/egov-services/master/docs/common/contracts/v1-0-0.yml#/definitions/ErrorRes'
      tags:
        - Scrutinize Plan

  /rest/dcr/scrutinydetails:
    post:
      summary: Get plan detail object by passing transaction number or edcr number.
      requestBody:
        description: Get the scrutinized plan and detail by passing transaction number or edcr number.
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ScrutinizePlanSearchReq'  
      parameters:
        - name: tenantId
          in: query
          description: city name
          required: true
          schema:
           type: string
        - name: edcrNumber
          in: query
          description: edcr Number 
          required: false
          schema:
           type: string
        - name: transactionNumber
          in: query
          description: transaction Number 
          required: true
          schema:
           type: string
      responses:
        '200':
          description: successful return of details if exist
          content:
            application/json:
              schema:
                type: array
                items:
                   $ref: '#/components/schemas/ScrutinizePlanResponse'
              encoding:
                dxfFile:
                # only accept dxf file.
                  contentType: application/dxf
                planPdfs:
                  contentType: application/pdf
                planReport:
                  contentType: application/pdf     
      tags:
        - View Scrutiny Details
  /edcr/oauth/token:
    post:
      summary: To access the Secured RESTful APIs, Access token is required. Use this API to get the access token which is valid for 30 mins. 
      requestBody:
        description: By passing username and password auth generate oAuth token.
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AuthTokenRequest'  
      parameters:
        - name: tenantId
          in: query
          description: city name
          required: true
          schema:
           type: string
        - name: userName
          in: header
          required: true
          description: Client User Name
          schema:
            type: string
        - name: password
          in: header
          required: true
          description: Client Password
          schema:
            type: string
            format: password
      responses:
        '200':
          description: successful return of details if exist
          content:
            application/json:
              schema:
                   $ref: '#/components/schemas/AuthTokenResponse'
      tags:
        - Get Access Token
components:
  schemas:
    EdcrDetail:
      type: object
      description: EncrReqObject contains data to be encrypted and meta-data required to perform the encryption.
      properties:
        transactionNumber:
          type: string
          description: Unique Transaction Number of each request.
        planDetail:
          type: string
          description: Dxf file content in json format. The content of dxf file converted to object structure and return in json format.
        edcrNumber:
          type: string
          description: If application approved, dcr number will be generated
        planPdfs:
          type:  array
          items:
            type: string
            format: binary 
            description: Auto generated pdfs
        dxfFile:
            type: string
            format: binary  
            description: Scrutinizeed dxf file
            maximum: 23333
        updatedDxfFile:
            type: string
            format: binary  
            description: Scrutinizeed dxf file
            maximum: 23333
        planReport:
            type: string
            format: binary  
            description: Generated report 
        status:
            type: string
            description: Status of the application
            enum:
              - Approved
              - Rejected
        tenantId:
          # Rules scrutiny based on tenant id.
          $ref: 'https://raw.githubusercontent.com/egovernments/egov-services/master/docs/common/contracts/v1-0-0.yml#/parameters/tenantId'
    ScrutinizePlanSearchReq:
      type: object
      description: ScrutinizePlanSearchReq contains data to be search as plan
      properties:
        requestInfo:
          $ref: 'https://raw.githubusercontent.com/egovernments/egov-services/master/docs/common/contracts/v1-0-0.yml#/definitions/RequestInfo'
      required:
         -  requestInfo
    ScrutinizePlanReq:
      type: object
      description: ScrutinizePlanReq contains data to be submit as plan
      properties:
        tenantId:
          # Rules scrutiny based on tenant id.
          $ref: 'https://raw.githubusercontent.com/egovernments/egov-services/master/docs/common/contracts/v1-0-0.yml#/parameters/tenantId'
        transactionNumber:
          type: string
          description: Unique Transaction Number for each request.
        requestInfo:
          $ref: 'https://raw.githubusercontent.com/egovernments/egov-services/master/docs/common/contracts/v1-0-0.yml#/definitions/RequestInfo'
        dxfFile:
            type: string
            format: binary  
            description: Scrutinized dxf file
      example:
          tenantId: "sonpur"
          transactionNumber: "1"
          requestInfo: {
          }
          dxfFile:  ""
      required:
         -  tenantId
         -  transactionNumber
         -  dxfFile
    ScrutinizePlanResponse:
      description: Contract class for web response. Array of ScrutinizePlan items  are used in case of search.
      properties:
        responseInfo:
          $ref: 'https://raw.githubusercontent.com/egovernments/egov-services/master/docs/common/contracts/v1-0-0.yml#/definitions/ResponseInfo'
        edcrDetail:
          description: Used for search result and create only
          type:  array
          items:
            $ref: '#/components/schemas/EdcrDetail'
    AuthTokenRequest:
      type: object
      description: ScrutinizePlanReq contains data to be submit as plan
      properties:
        grant_type:
          type: string
          description: Refers to the way an application gets an access token.
        username:
          type: string
          description: The unique user name of the User.
        password:
            type: string
            description: The password of the user name to login to the system.
      example:
          grant_type: "password"
          username: "username"
          password: "password"
      required:
         -  grant_type
         -  username
         -  password
    AuthTokenResponse:
      type: object
      description: The access token is given by the authorization server when it accepts the client ID and client password sent by the client application.
      properties:
        access_token:
          type: string
          description: The access token string as issued by the authorization server.
        token_type:
          type: string
          description: Specifies type of token.
        expires_in:
          type: integer
          description: Specifies the duration of access token expiry.
        refresh_token:
          type: string
          description:  It provides a refresh token, if the access token expires, to get the new access token using the authorization grant.
        scope:
            type: string
            description: Specific actions application can be allowed.
      example:
          access_token: "e3b98877-f225-45e2-add4-3c53eeb6e7a8"
          token_type: "bearer"
          refresh_token: "58f34753-7695-4a71-c08a-d40241ec3dfb"
          expires_in: 4499
          scope: "read write"

